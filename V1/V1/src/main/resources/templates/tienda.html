<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org"
      th:replace="base :: base('Tienda | Skate Pro', ~{::content})">
<th:block th:fragment="content">
<div class="container my-5">
    <h1 class="display-4 fw-bold mb-5 text-center text-uppercase">Explora Nuestro Catalogo</h1>
    
    <div class="row">
        
        <div class="col-lg-3 d-none d-lg-block">
            <aside class="sticky-top sidebar-filtros">
                <h4 class="mb-3 fw-bold">Filtrar Productos</h4>
                
                <form th:action="@{/tienda}" method="get" class="mb-4 p-3 border rounded shadow-sm">
                    <h6 class="fw-bold text-uppercase text-primary">Categoria</h6>
                    <div class="mt-2">
                        <select name="categoria" class="form-select form-select-sm">
                            <option value="" th:selected="${selectedCategoria == ''}">Todas</option>
                            <option th:each="cat : ${categories}"
                                    th:value="${cat}"
                                    th:text="${cat}"
                                    th:selected="${cat == selectedCategoria}">
                            </option>
                        </select>
                    </div>
                    <input type="hidden" name="sort" th:value="${sort}">
                    <button class="btn btn-primary w-100 btn-sm mt-3" type="submit">Aplicar filtros</button>
                    <a th:href="@{/tienda(sort=${sort})}" class="btn btn-outline-secondary w-100 btn-sm mt-2">Limpiar filtros</a>
                </form>
            </aside>
        </div>
        
        <div class="col-lg-9">
            <div class="row mb-4 align-items-center">
                <div class="col-md-6">
                    <p class="text-muted small mb-0">
                        Mostrando <span th:text="${startItem}">0</span>-<span th:text="${endItem}">0</span> de <span th:text="${totalProducts}">0</span> productos
                    </p>
                </div>
                <div class="col-md-6 text-md-end">
                    <form th:action="@{/tienda}" method="get" class="d-inline-block">
                        <input type="hidden" name="categoria" th:value="${selectedCategoria}">
                        <input type="hidden" name="page" th:value="${currentPage}">
                        <input type="hidden" name="size" th:value="${pageSize}">
                        <select name="sort" class="form-select form-select-sm d-inline-block w-auto" onchange="this.form.submit()">
                            <option value="nuevo" th:selected="${sort == 'nuevo'}">Ordenar por novedad</option>
                            <option value="precioAsc" th:selected="${sort == 'precioAsc'}">Precio: bajo a alto</option>
                            <option value="precioDesc" th:selected="${sort == 'precioDesc'}">Precio: alto a bajo</option>
                        </select>
                    </form>
                </div>
            </div>

            <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
                <div class="col" th:each="producto : ${products}">
                    <div class="card h-100 border-0 shadow-sm product-card">
                        <div class="product-img-container">
                            <img th:src="${#strings.isEmpty(producto.imagenUrl)} ? 'https://placehold.co/400x400?text=Producto' : ${producto.imagenUrl}"
                                 src="/images/canariam.png"
                                 class="card-img-top product-img"
                                 th:alt="${producto.nombre}"
                                 alt="Producto">
                        </div>
                        <div class="card-body text-center">
                            <h5 class="card-title fw-bold" th:text="${producto.nombre}">Producto</h5>
                            <p class="card-text text-muted small mb-1" th:text="'Categoria: ' + ${producto.categoria}">Categoria</p>
                            <p class="fs-5 fw-bold text-primary" th:text="'$' + ${#numbers.formatDecimal(producto.precio, 0, 'COMMA', 0, 'POINT')}">$0</p>
                            <div class="small text-muted" th:text="${producto.requiereEnvio} ? 'Requiere envio' : 'Digital / presencial'">Envio</div>
                            <form th:action="@{/cart/add}" method="post" class="d-flex gap-2 mt-2">
                                <input type="hidden" name="productId" th:value="${producto.id}"/>
                                <input type="hidden" name="qty" value="1"/>
                                <button type="submit" class="btn btn-sm btn-primary flex-grow-1">Agregar</button>
                                <a th:href="@{/producto/{id}(id=${producto.id})}" class="btn btn-sm btn-outline-primary">Ver</a>
                            </form>
                        </div>
                    </div>
                </div>

                <div class="col-12 text-center text-muted" th:if="${#lists.isEmpty(products)}">
                    No hay productos disponibles en este momento.
                </div>
            </div>
            
            <nav class="mt-5" th:if="${totalPages > 1}">
                <ul class="pagination justify-content-center">
                    <li class="page-item" th:classappend="${currentPage == 1} ? ' disabled'">
                        <a class="page-link"
                           th:href="@{/tienda(page=${currentPage - 1}, sort=${sort}, categoria=${selectedCategoria}, size=${pageSize})}">Anterior</a>
                    </li>
                    <li class="page-item"
                        th:each="i : ${#numbers.sequence(1, totalPages)}"
                        th:classappend="${i == currentPage} ? ' active'">
                        <a class="page-link"
                           th:text="${i}"
                           th:href="@{/tienda(page=${i}, sort=${sort}, categoria=${selectedCategoria}, size=${pageSize})}">1</a>
                    </li>
                    <li class="page-item" th:classappend="${currentPage == totalPages} ? ' disabled'">
                        <a class="page-link"
                           th:href="@{/tienda(page=${currentPage + 1}, sort=${sort}, categoria=${selectedCategoria}, size=${pageSize})}">Siguiente</a>
                    </li>
                </ul>
            </nav>

        </div>
    </div>
</div>
</th:block>
</html>
